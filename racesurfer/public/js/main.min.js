/** @license
 * RequireJS plugin for async dependency load like JSONP and Google Maps
 * Author: Miller Medeiros
 * Version: 0.1.1 (2011/11/17)
 * Released under the MIT license
 */

define("state",["backbone"],function(e){var t=e.Model.extend({defaults:{pos:{},gmap:!1}});return new t}),define("templates",["underscore"],function(){var e={};e.item=['<a href="#">','<i class="icon-chevron-right pull-right"></i>',"<%= title %> <br>","</a>",'<div class="info"> <%= meta.city %>, <%= meta.eventState %> - <%= startDate %> <%= startTime %> </div>','<div class="details hide"> <a href="<%= url %>">Register</a> <br> <%= meta.allText %> </div>'],e.itemSummary=["Your search returned <%= count %> results."],e.loader=['<img class="loader" src="img/ajax-loader.gif"> Loading...'],e.infowindow=['<h5 class="no-padding no-margin"> <%= title %> </h5>',"<%= meta.eventAddress %> <br>","<%= meta.city %>, <%= meta.eventState %>"];for(var t in e)if(e.hasOwnProperty(t)){var n=e[t].join("\n");e[t]=_.template(n)}return e}),define("collections/items",["backbone"],function(e){var t=e.Collection.extend({initialize:function(e){this.url=e.url},parse:function(e){return e._results}});return t}),define("collections/photos",["backbone"],function(e){var t=e.Collection.extend({initialize:function(e){this.url=e.url},parse:function(e){console.log(e)}});return t}),define("views/item",["backbone","templates"],function(e,t){var n=e.View.extend({tagName:"li",template:t.item,initialize:function(){this.listenTo(this.model,"destroy",this.remove),this.render()},render:function(){this.model.set("startDate",(new Date(this.model.get("meta").startDate)).toLocaleDateString()),this.model.set("startTime",(new Date(this.model.get("meta").startDate+" "+this.model.get("meta").startTime)).toLocaleTimeString());var e=this.template(this.model.toJSON());return this.$el.html(e).attr("data-cid",this.model.cid),this}});return n}),define("views/list",["backbone","views/item"],function(e,t){var n=e.View.extend({tagName:"ul",className:"nav nav-stacked nav-pills nav-styled",initialize:function(){this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"set",this.render),this.listenTo(this.collection,"remove",this.remove),this.$el.on("click","a",function(){$(this).find("i").toggleClass("icon-chevron-down").closest("li").find("div.details").slideToggle(1e3)})},render:function(){this.$el.empty(),this.collection.each(function(e){this.addOne(e)})},addOne:function(e){var n=new t({model:e});this.el.appendChild(n.el)},remove:function(e){e.trigger("destroy")}});return n}),define("views/itemSummary",["backbone","templates"],function(e,t){var n=e.View.extend({tagName:"div",className:"summary text-center",template:t.itemSummary,initialize:function(){this.listenTo(this.collection,"all",this.render),this.el.innerHTML='Click "Allow" when the Gelocation prompt appears.'},render:function(){}});return n}),define("app",["jquery","state","templates","collections/items","collections/photos","views/list","views/itemSummary"],function(e,t,n,r,i,s,o){var u={initialize:function(){var u={$sidebar:e(".sidebar"),$input:e(".input-append > input[type='text']"),$search:e(".input-append > span.search"),$map:e(".map-container")},a=new r({url:paths.active}),f=new i({url:paths.flickr}),l=new s({collection:a}),c=new o({collection:a}),h;u.$sidebar.append(c.el).append(l.el),"geolocation"in navigator?(navigator.geolocation.getCurrentPosition(function(e){t.set("pos",{lat:e.coords.latitude,lng:e.coords.longitude}),c.el.innerHTML="Google Maps initialzing...",t.get("gmap")||require(["views/gmap"],function(e){h=new e({collection:a}),u.$map[0].appendChild(h.render().el),t.set("gmap",!0),c.el.innerHTML="Enter a search term above to populate results."})}),l.$el.on("click","a",function(){var t=e(this).closest("li").attr("data-cid");h.infowindows[t].open(h.map,h.markers[t]),h.map.setCenter(h.markers[t].getPosition())}),u.$input.on("keyup",function(e){e.keyCode===13&&u.$search.click()}),u.$search.on("click",function(){c.$el.html(n.loader()),a.fetch({data:{term:u.$input.val(),lat:t.get("pos").lat,lng:t.get("pos").lng},success:function(){c.$el.html(n.itemSummary({count:a.models.length}))}})})):u.$input.val("Geolocation is not supported in your browser.").addClass("input-xxlarge").prop("disabled","disabled").next().hide()}};return u}),define("async",[],function(){function n(e){var t,n;t=document.createElement("script"),t.type="text/javascript",t.async=!0,t.src=e,n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n)}function r(t,n){var r=/!(.+)/,i=t.replace(r,""),s=r.test(t)?t.replace(/.+!/,""):e;return i+=i.indexOf("?")<0?"?":"&",i+s+"="+n}function i(){return t+=1,"__async_req_"+t+"__"}var e="callback",t=0;return{load:function(e,t,s,o){if(o.isBuild)s(null);else{var u=i();window[u]=s,n(r(e,u))}}}}),require.config({baseUrl:"js/",paths:{jquery:["http://code.jquery.com/jquery-1.10.1.min","../bower_components/jquery/jquery.min"],underscore:["http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.1/underscore-min","../bower_components/underscore/underscore-min"],backbone:["http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min","../bower_components/backbone/backbone-min"],async:"lib/async"},shim:{underscore:{exports:"_"},backbone:{deps:["jquery","underscore"],exports:"Backbone"}}}),require(["app","async"],function(e){e.initialize()}),define("main",function(){});